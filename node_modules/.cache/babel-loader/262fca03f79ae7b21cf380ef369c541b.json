{"ast":null,"code":"'use strict';\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nvar _createClass = function () {\n  function defineProperties(target, props) {\n    for (var i = 0; i < props.length; i++) {\n      var descriptor = props[i];\n      descriptor.enumerable = descriptor.enumerable || false;\n      descriptor.configurable = true;\n      if (\"value\" in descriptor) descriptor.writable = true;\n      Object.defineProperty(target, descriptor.key, descriptor);\n    }\n  }\n\n  return function (Constructor, protoProps, staticProps) {\n    if (protoProps) defineProperties(Constructor.prototype, protoProps);\n    if (staticProps) defineProperties(Constructor, staticProps);\n    return Constructor;\n  };\n}();\n\nvar _react = require('react');\n\nvar _react2 = _interopRequireDefault(_react);\n\nvar _Flowpoint = require('./Flowpoint.js');\n\nvar _Flowpoint2 = _interopRequireDefault(_Flowpoint);\n\nvar _Helpers = require('./Helpers.js');\n\nfunction _interopRequireDefault(obj) {\n  return obj && obj.__esModule ? obj : {\n    default: obj\n  };\n}\n\nfunction _defineProperty(obj, key, value) {\n  if (key in obj) {\n    Object.defineProperty(obj, key, {\n      value: value,\n      enumerable: true,\n      configurable: true,\n      writable: true\n    });\n  } else {\n    obj[key] = value;\n  }\n\n  return obj;\n}\n\nfunction _classCallCheck(instance, Constructor) {\n  if (!(instance instanceof Constructor)) {\n    throw new TypeError(\"Cannot call a class as a function\");\n  }\n}\n\nfunction _possibleConstructorReturn(self, call) {\n  if (!self) {\n    throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\");\n  }\n\n  return call && (typeof call === \"object\" || typeof call === \"function\") ? call : self;\n}\n\nfunction _inherits(subClass, superClass) {\n  if (typeof superClass !== \"function\" && superClass !== null) {\n    throw new TypeError(\"Super expression must either be null or a function, not \" + typeof superClass);\n  }\n\n  subClass.prototype = Object.create(superClass && superClass.prototype, {\n    constructor: {\n      value: subClass,\n      enumerable: false,\n      writable: true,\n      configurable: true\n    }\n  });\n  if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass;\n} // Component class\n\n\nvar Flowspace = function (_Component) {\n  _inherits(Flowspace, _Component);\n\n  function Flowspace(props) {\n    _classCallCheck(this, Flowspace);\n\n    var _this = _possibleConstructorReturn(this, (Flowspace.__proto__ || Object.getPrototypeOf(Flowspace)).call(this, props));\n\n    _this.state = {}; // Helper variables\n\n    _this.didMount = false; // Used to determine when drawing of connections should start\n    // Binding class methods\n\n    _this.updateFlowspace = _this.updateFlowspace.bind(_this);\n    _this.handleFlowspaceClick = _this.handleFlowspaceClick.bind(_this);\n    return _this;\n  }\n\n  _createClass(Flowspace, [{\n    key: 'updateFlowspace',\n    value: function updateFlowspace(key, pos) {\n      this.setState(_defineProperty({}, key, pos));\n    }\n  }, {\n    key: 'componentDidMount',\n    value: function componentDidMount() {\n      this.didMount = true;\n    }\n  }, {\n    key: 'handleFlowspaceClick',\n    value: function handleFlowspaceClick(e) {\n      // Testing click if this.props.onClick is defined\n      if (this.props.onClick) {\n        // Testing helper variable\n        var isSpaceClick = false; // Testing click target (don't fire if flowpoint or connection was clicked)\n\n        if (e.target) {\n          var test = ['flowcontainer', 'flowspace', 'flowconnections'];\n          if (test.includes(e.target.className.baseVal)) isSpaceClick = true;\n          if (test.includes(e.target.className)) isSpaceClick = true;\n        } // Potentially triggering user-defined onClick\n\n\n        if (isSpaceClick) {\n          this.props.onClick(e);\n          e.stopPropagation();\n        }\n      }\n    }\n  }, {\n    key: 'render',\n    value: function render() {\n      var _this2 = this; // Colors\n\n\n      var theme_colors = (0, _Helpers.getColor)(this.props.theme || 'indigo');\n      var background_color = (0, _Helpers.getColor)(this.props.background || 'white');\n      var selected = this.props.selected ? Array.isArray(this.props.selected) ? this.props.selected : [this.props.selected] : []; // Helper variables\n\n      var connections = [];\n      var paths = [];\n      var gradients = [];\n      var defs = {};\n      var maxX = 0;\n      var maxY = 0; // Extracting connections and adding updateFlowspace to all children\n\n      var newKeys = [];\n\n      var childrenWithProps = _react2.default.Children.map(this.props.children, function (child) {\n        if (child.type === _Flowpoint2.default) {\n          var outputs = child.props.outputs; // Outputs can be defined as array or object\n\n          if (outputs instanceof Array) {\n            outputs.map(function (out_key) {\n              connections.push({\n                a: child.key,\n                b: out_key,\n                width: _this2.props.connectionSize || 4,\n                outputLoc: 'auto',\n                inputLoc: 'auto',\n                outputColor: theme_colors.p,\n                inputColor: _this2.props.noFade ? theme_colors.p : theme_colors.a,\n                dash: undefined,\n                onClick: null\n              });\n            });\n          } else if (outputs instanceof Object) {\n            Object.keys(outputs).map(function (out_key) {\n              var output = outputs[out_key];\n              connections.push({\n                a: child.key,\n                b: out_key,\n                width: output.width || _this2.props.connectionSize || 4,\n                outputLoc: output.output || 'auto',\n                inputLoc: output.input || 'auto',\n                outputColor: output.outputColor || theme_colors.p,\n                inputColor: output.inputColor || (_this2.props.noFade ? theme_colors.p : theme_colors.a),\n                arrowStart: output.arrowStart,\n                arrowEnd: output.arrowEnd,\n                dash: output.dash !== undefined ? output.dash > 0 ? output.dash : undefined : undefined,\n                onClick: output.onClick ? function (e) {\n                  output.onClick(child.key, out_key, e);\n                } : _this2.props.onLineClick ? function (e) {\n                  _this2.props.onLineClick(child.key, out_key, e);\n                } : null\n              });\n            });\n          }\n\n          ; // Adding to newKeys\n\n          newKeys.push(child.key); // Returning updated child element\n\n          return _react2.default.cloneElement(child, {\n            updateFlowspace: _this2.updateFlowspace,\n            id: child.key,\n            selected: child.props.selected || selected.includes(child.key),\n            spaceColor: background_color,\n            variant: child.props.variant || _this2.props.variant || 'paper',\n            theme: child.props.theme || _this2.props.theme || 'indigo'\n          });\n        }\n\n        ;\n      }); // Removing unused positions\n\n\n      Object.keys(this.state).map(function (testkey) {\n        if (!newKeys.includes(testkey)) delete _this2.state[testkey];\n      }); // Drawing of connections will only start after Flowspace have been mounted once.\n\n      if (this.didMount) {\n        // Getting flowspace size\n        Object.keys(this.state).map(function (key) {\n          var point = _this2.state[key];\n          maxX = Math.max(maxX, point.x + 4 * point.width);\n          maxY = Math.max(maxY, point.y + 4 * point.height);\n        }); // Looping through connections and adding paths and gradients.\n\n        var newCons = [];\n        connections.map(function (connection) {\n          // Loop specifics\n          var pa = _this2.state[connection.a];\n          var pb = _this2.state[connection.b];\n          var con_key = connection.a + '_' + connection.b;\n          var grad_name = 'grad_' + con_key; // Adding to this cycle's connections\n\n          newCons.push(con_key); // Continuing only if both pa and pb are defined\n\n          if (pa && pb) {\n            // Calculate new positions or get old ones\n            var positions = (0, _Helpers.AutoGetLoc)(pa, pb, connection.outputLoc, connection.inputLoc, connection.a, connection.b, _this2.state, _this2.props.avoidCollisions === false ? false : true); // Display arrows - if set then connection-specific overrides flowspace\n\n            var markerStart = _this2.props.arrowStart;\n            if (connection.arrowStart !== undefined) markerStart = connection.arrowStart;\n            var markerEnd = _this2.props.arrowEnd;\n            if (connection.arrowEnd !== undefined) markerEnd = connection.arrowEnd; // Adding coloured arrow-marker definitions to list (if not already present)\n\n            if (markerStart && !defs[connection.outputColor]) defs[connection.outputColor] = _react2.default.createElement('marker', {\n              id: \"arrow\" + connection.outputColor,\n              viewBox: '0 0 50 50',\n              markerWidth: '5',\n              markerHeight: '5',\n              refX: '45',\n              refY: '24',\n              orient: 'auto-start-reverse',\n              markerUnits: 'strokeWidth'\n            }, _react2.default.createElement('path', {\n              d: 'M0,0 L50,20 v8 L0,48 L6,24 Z',\n              fill: connection.outputColor,\n              'stroke-width': '0',\n              opacity: '1'\n            }));\n            if (markerEnd && !defs[connection.inputColor]) defs[connection.inputColor] = _react2.default.createElement('marker', {\n              id: \"arrow\" + connection.inputColor,\n              viewBox: '0 0 50 50',\n              markerWidth: '5',\n              markerHeight: '5',\n              refX: '45',\n              refY: '24',\n              orient: 'auto-start-reverse',\n              markerUnits: 'strokeWidth'\n            }, _react2.default.createElement('path', {\n              d: 'M0,0 L50,20 v8 L0,48 L6,24 Z',\n              fill: connection.inputColor,\n              'stroke-width': '0',\n              opacity: '1'\n            })); // Calculating bezier offsets and adding new path to list\n\n            var d = Math.round(Math.pow(Math.pow(positions.output.x - positions.input.x, 2) + Math.pow(positions.output.y - positions.input.y, 2), 0.5) / 2);\n            var pathkey = 'path_' + connection.a + '_' + connection.b;\n            var isSelectedLine = false;\n\n            if (_this2.props.selectedLine) {\n              if (_this2.props.selectedLine.a === connection.a && _this2.props.selectedLine.b === connection.b) isSelectedLine = true;\n            }\n\n            paths.push(_react2.default.createElement('path', {\n              key: pathkey,\n              className: 'flowconnection',\n              style: {\n                transition: 'stroke-width 0.15s ease-in-out',\n                strokeDasharray: connection.dash\n              },\n              d: 'M' + positions.output.x + ',' + positions.output.y + 'C' + (positions.output.x + (positions.output.offsetX > 0 ? Math.min(d, positions.output.offsetX) : Math.max(-d, positions.output.offsetX))) + ',' + (positions.output.y + (positions.output.offsetY > 0 ? Math.min(d, positions.output.offsetY) : Math.max(-d, positions.output.offsetY))) + ' ' + (positions.input.x + (positions.input.offsetX > 0 ? Math.min(d, positions.input.offsetX) : Math.max(-d, positions.input.offsetX))) + ',' + (positions.input.y + (positions.input.offsetY > 0 ? Math.min(d, positions.input.offsetY) : Math.max(-d, positions.input.offsetY))) + ' ' + (positions.input.x - 0.01) + ',' + (positions.input.y - 0.01),\n              fill: 'none',\n              stroke: 'url(#' + grad_name + ')',\n              strokeWidth: parseInt(connection.width) + (isSelectedLine ? 3 : 0),\n              onClick: connection.onClick,\n              markerStart: markerStart ? 'url(#arrow' + connection.outputColor + ')' : null,\n              markerEnd: markerEnd ? 'url(#arrow' + connection.inputColor + ')' : null\n            })); // Calculating how x and y should affect gradient\n\n            var p1 = {\n              x: 0,\n              y: 0\n            };\n            var p2 = {\n              x: 0,\n              y: 0\n            };\n            var maxD = Math.max(Math.abs(positions.output.x - positions.input.x), Math.abs(positions.output.y - positions.input.y)) + 1e-5;\n\n            if (Math.abs(positions.output.x - positions.input.x) > Math.abs(positions.output.y - positions.input.y)) {\n              if (positions.output.x > positions.input.x) {\n                p1.x = maxD;\n              } else {\n                p2.x = maxD;\n              }\n            } else {\n              if (positions.output.y > positions.input.y) {\n                p1.y = maxD;\n              } else {\n                p2.y = maxD;\n              }\n            }\n\n            p1.x /= maxD;\n            p1.y /= maxD;\n            p2.x /= maxD;\n            p2.y /= maxD; // Adding gradient to list\n\n            gradients.push(_react2.default.createElement('linearGradient', {\n              key: grad_name,\n              id: grad_name,\n              x1: p1.x,\n              y1: p1.y,\n              x2: p2.x,\n              y2: p2.y\n            }, _react2.default.createElement('stop', {\n              offset: '0',\n              stopColor: connection.outputColor\n            }), _react2.default.createElement('stop', {\n              offset: '1',\n              stopColor: connection.inputColor\n            })));\n          }\n        });\n      } // Adding scroll (settings for overflow will be overwritten if defined by user)\n\n\n      var style = {\n        overflow: 'scroll',\n        backgroundColor: background_color.p\n      };\n\n      if (this.props.style) {\n        Object.keys(this.props.style).map(function (propkey) {\n          style[propkey] = _this2.props.style[propkey];\n        });\n      }\n\n      ; // Returning finished Flowspace\n\n      return _react2.default.createElement('div', {\n        style: style,\n        onClick: this.handleFlowspaceClick,\n        className: 'flowcontainer'\n      }, _react2.default.createElement('div', {\n        style: {\n          width: maxX,\n          height: maxY,\n          position: 'relative',\n          overflow: 'visible'\n        },\n        className: 'flowspace'\n      }, _react2.default.createElement('div', {\n        ref: function ref(_ref) {\n          if (_this2.props.getDiagramRef) _this2.props.getDiagramRef(_ref);\n        },\n        style: {\n          width: '100%',\n          height: '100%',\n          backgroundColor: background_color.p\n        }\n      }, _react2.default.createElement('svg', {\n        style: {\n          width: '100%',\n          height: '100%',\n          position: 'absolute',\n          overflow: 'visible'\n        },\n        className: 'flowconnections'\n      }, _react2.default.createElement('defs', null, Object.values(defs)), gradients, paths), childrenWithProps)));\n    }\n  }]);\n\n  return Flowspace;\n}(_react.Component);\n\nexports.default = Flowspace;","map":{"version":3,"sources":["C:/Users/Abdullah/personal-portfolio/node_modules/flowpoints/dist/Flowspace.js"],"names":["Object","defineProperty","exports","value","_createClass","defineProperties","target","props","i","length","descriptor","enumerable","configurable","writable","key","Constructor","protoProps","staticProps","prototype","_react","require","_react2","_interopRequireDefault","_Flowpoint","_Flowpoint2","_Helpers","obj","__esModule","default","_defineProperty","_classCallCheck","instance","TypeError","_possibleConstructorReturn","self","call","ReferenceError","_inherits","subClass","superClass","create","constructor","setPrototypeOf","__proto__","Flowspace","_Component","_this","getPrototypeOf","state","didMount","updateFlowspace","bind","handleFlowspaceClick","pos","setState","componentDidMount","e","onClick","isSpaceClick","test","includes","className","baseVal","stopPropagation","render","_this2","theme_colors","getColor","theme","background_color","background","selected","Array","isArray","connections","paths","gradients","defs","maxX","maxY","newKeys","childrenWithProps","Children","map","children","child","type","outputs","out_key","push","a","b","width","connectionSize","outputLoc","inputLoc","outputColor","p","inputColor","noFade","dash","undefined","keys","output","input","arrowStart","arrowEnd","onLineClick","cloneElement","id","spaceColor","variant","testkey","point","Math","max","x","y","height","newCons","connection","pa","pb","con_key","grad_name","positions","AutoGetLoc","avoidCollisions","markerStart","markerEnd","createElement","viewBox","markerWidth","markerHeight","refX","refY","orient","markerUnits","d","fill","opacity","round","pow","pathkey","isSelectedLine","selectedLine","style","transition","strokeDasharray","offsetX","min","offsetY","stroke","strokeWidth","parseInt","p1","p2","maxD","abs","x1","y1","x2","y2","offset","stopColor","overflow","backgroundColor","propkey","position","ref","_ref","getDiagramRef","values","Component"],"mappings":"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","sourcesContent":["'use strict';\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\nvar _react = require('react');\n\nvar _react2 = _interopRequireDefault(_react);\n\nvar _Flowpoint = require('./Flowpoint.js');\n\nvar _Flowpoint2 = _interopRequireDefault(_Flowpoint);\n\nvar _Helpers = require('./Helpers.js');\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nfunction _defineProperty(obj, key, value) { if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nfunction _possibleConstructorReturn(self, call) { if (!self) { throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\"); } return call && (typeof call === \"object\" || typeof call === \"function\") ? call : self; }\n\nfunction _inherits(subClass, superClass) { if (typeof superClass !== \"function\" && superClass !== null) { throw new TypeError(\"Super expression must either be null or a function, not \" + typeof superClass); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } }); if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass; }\n\n// Component class\nvar Flowspace = function (_Component) {\n  _inherits(Flowspace, _Component);\n\n  function Flowspace(props) {\n    _classCallCheck(this, Flowspace);\n\n    var _this = _possibleConstructorReturn(this, (Flowspace.__proto__ || Object.getPrototypeOf(Flowspace)).call(this, props));\n\n    _this.state = {};\n\n    // Helper variables\n    _this.didMount = false; // Used to determine when drawing of connections should start\n\n    // Binding class methods\n    _this.updateFlowspace = _this.updateFlowspace.bind(_this);\n    _this.handleFlowspaceClick = _this.handleFlowspaceClick.bind(_this);\n\n    return _this;\n  }\n\n  _createClass(Flowspace, [{\n    key: 'updateFlowspace',\n    value: function updateFlowspace(key, pos) {\n      this.setState(_defineProperty({}, key, pos));\n    }\n  }, {\n    key: 'componentDidMount',\n    value: function componentDidMount() {\n      this.didMount = true;\n    }\n  }, {\n    key: 'handleFlowspaceClick',\n    value: function handleFlowspaceClick(e) {\n\n      // Testing click if this.props.onClick is defined\n      if (this.props.onClick) {\n\n        // Testing helper variable\n        var isSpaceClick = false;\n\n        // Testing click target (don't fire if flowpoint or connection was clicked)\n        if (e.target) {\n          var test = ['flowcontainer', 'flowspace', 'flowconnections'];\n          if (test.includes(e.target.className.baseVal)) isSpaceClick = true;\n          if (test.includes(e.target.className)) isSpaceClick = true;\n        }\n\n        // Potentially triggering user-defined onClick\n        if (isSpaceClick) {\n          this.props.onClick(e);\n          e.stopPropagation();\n        }\n      }\n    }\n  }, {\n    key: 'render',\n    value: function render() {\n      var _this2 = this;\n\n      // Colors\n      var theme_colors = (0, _Helpers.getColor)(this.props.theme || 'indigo');\n      var background_color = (0, _Helpers.getColor)(this.props.background || 'white');\n      var selected = this.props.selected ? Array.isArray(this.props.selected) ? this.props.selected : [this.props.selected] : [];\n\n      // Helper variables\n      var connections = [];\n      var paths = [];\n      var gradients = [];\n      var defs = {};\n      var maxX = 0;\n      var maxY = 0;\n\n      // Extracting connections and adding updateFlowspace to all children\n      var newKeys = [];\n      var childrenWithProps = _react2.default.Children.map(this.props.children, function (child) {\n\n        if (child.type === _Flowpoint2.default) {\n\n          var outputs = child.props.outputs;\n\n          // Outputs can be defined as array or object\n          if (outputs instanceof Array) {\n\n            outputs.map(function (out_key) {\n              connections.push({\n                a: child.key,\n                b: out_key,\n                width: _this2.props.connectionSize || 4,\n                outputLoc: 'auto',\n                inputLoc: 'auto',\n                outputColor: theme_colors.p,\n                inputColor: _this2.props.noFade ? theme_colors.p : theme_colors.a,\n                dash: undefined,\n                onClick: null\n              });\n            });\n          } else if (outputs instanceof Object) {\n\n            Object.keys(outputs).map(function (out_key) {\n              var output = outputs[out_key];\n              connections.push({\n                a: child.key,\n                b: out_key,\n                width: output.width || _this2.props.connectionSize || 4,\n                outputLoc: output.output || 'auto',\n                inputLoc: output.input || 'auto',\n                outputColor: output.outputColor || theme_colors.p,\n                inputColor: output.inputColor || (_this2.props.noFade ? theme_colors.p : theme_colors.a),\n                arrowStart: output.arrowStart,\n                arrowEnd: output.arrowEnd,\n                dash: output.dash !== undefined ? output.dash > 0 ? output.dash : undefined : undefined,\n                onClick: output.onClick ? function (e) {\n                  output.onClick(child.key, out_key, e);\n                } : _this2.props.onLineClick ? function (e) {\n                  _this2.props.onLineClick(child.key, out_key, e);\n                } : null\n              });\n            });\n          };\n\n          // Adding to newKeys\n          newKeys.push(child.key);\n\n          // Returning updated child element\n          return _react2.default.cloneElement(child, {\n            updateFlowspace: _this2.updateFlowspace,\n            id: child.key,\n            selected: child.props.selected || selected.includes(child.key),\n            spaceColor: background_color,\n            variant: child.props.variant || _this2.props.variant || 'paper',\n            theme: child.props.theme || _this2.props.theme || 'indigo'\n          });\n        };\n      });\n\n      // Removing unused positions\n      Object.keys(this.state).map(function (testkey) {\n        if (!newKeys.includes(testkey)) delete _this2.state[testkey];\n      });\n\n      // Drawing of connections will only start after Flowspace have been mounted once.\n      if (this.didMount) {\n\n        // Getting flowspace size\n        Object.keys(this.state).map(function (key) {\n          var point = _this2.state[key];\n          maxX = Math.max(maxX, point.x + 4 * point.width);\n          maxY = Math.max(maxY, point.y + 4 * point.height);\n        });\n\n        // Looping through connections and adding paths and gradients.\n        var newCons = [];\n        connections.map(function (connection) {\n\n          // Loop specifics\n          var pa = _this2.state[connection.a];\n          var pb = _this2.state[connection.b];\n          var con_key = connection.a + '_' + connection.b;\n\n          var grad_name = 'grad_' + con_key;\n\n          // Adding to this cycle's connections\n          newCons.push(con_key);\n\n          // Continuing only if both pa and pb are defined\n          if (pa && pb) {\n\n            // Calculate new positions or get old ones\n            var positions = (0, _Helpers.AutoGetLoc)(pa, pb, connection.outputLoc, connection.inputLoc, connection.a, connection.b, _this2.state, _this2.props.avoidCollisions === false ? false : true);\n\n            // Display arrows - if set then connection-specific overrides flowspace\n            var markerStart = _this2.props.arrowStart;\n            if (connection.arrowStart !== undefined) markerStart = connection.arrowStart;\n            var markerEnd = _this2.props.arrowEnd;\n            if (connection.arrowEnd !== undefined) markerEnd = connection.arrowEnd;\n\n            // Adding coloured arrow-marker definitions to list (if not already present)\n            if (markerStart && !defs[connection.outputColor]) defs[connection.outputColor] = _react2.default.createElement(\n              'marker',\n              { id: \"arrow\" + connection.outputColor, viewBox: '0 0 50 50', markerWidth: '5', markerHeight: '5', refX: '45', refY: '24', orient: 'auto-start-reverse', markerUnits: 'strokeWidth' },\n              _react2.default.createElement('path', { d: 'M0,0 L50,20 v8 L0,48 L6,24 Z', fill: connection.outputColor, 'stroke-width': '0', opacity: '1' })\n            );\n            if (markerEnd && !defs[connection.inputColor]) defs[connection.inputColor] = _react2.default.createElement(\n              'marker',\n              { id: \"arrow\" + connection.inputColor, viewBox: '0 0 50 50', markerWidth: '5', markerHeight: '5', refX: '45', refY: '24', orient: 'auto-start-reverse', markerUnits: 'strokeWidth' },\n              _react2.default.createElement('path', { d: 'M0,0 L50,20 v8 L0,48 L6,24 Z', fill: connection.inputColor, 'stroke-width': '0', opacity: '1' })\n            );\n\n            // Calculating bezier offsets and adding new path to list\n            var d = Math.round(Math.pow(Math.pow(positions.output.x - positions.input.x, 2) + Math.pow(positions.output.y - positions.input.y, 2), 0.5) / 2);\n            var pathkey = 'path_' + connection.a + '_' + connection.b;\n            var isSelectedLine = false;\n            if (_this2.props.selectedLine) {\n              if (_this2.props.selectedLine.a === connection.a && _this2.props.selectedLine.b === connection.b) isSelectedLine = true;\n            }\n            paths.push(_react2.default.createElement('path', {\n              key: pathkey,\n              className: 'flowconnection',\n              style: {\n                transition: 'stroke-width 0.15s ease-in-out',\n                strokeDasharray: connection.dash\n              },\n              d: 'M' + positions.output.x + ',' + positions.output.y + 'C' + (positions.output.x + (positions.output.offsetX > 0 ? Math.min(d, positions.output.offsetX) : Math.max(-d, positions.output.offsetX))) + ',' + (positions.output.y + (positions.output.offsetY > 0 ? Math.min(d, positions.output.offsetY) : Math.max(-d, positions.output.offsetY))) + ' ' + (positions.input.x + (positions.input.offsetX > 0 ? Math.min(d, positions.input.offsetX) : Math.max(-d, positions.input.offsetX))) + ',' + (positions.input.y + (positions.input.offsetY > 0 ? Math.min(d, positions.input.offsetY) : Math.max(-d, positions.input.offsetY))) + ' ' + (positions.input.x - 0.01) + ',' + (positions.input.y - 0.01),\n              fill: 'none',\n              stroke: 'url(#' + grad_name + ')',\n              strokeWidth: parseInt(connection.width) + (isSelectedLine ? 3 : 0),\n              onClick: connection.onClick,\n              markerStart: markerStart ? 'url(#arrow' + connection.outputColor + ')' : null,\n              markerEnd: markerEnd ? 'url(#arrow' + connection.inputColor + ')' : null\n            }));\n\n            // Calculating how x and y should affect gradient\n            var p1 = { x: 0, y: 0 };\n            var p2 = { x: 0, y: 0 };\n            var maxD = Math.max(Math.abs(positions.output.x - positions.input.x), Math.abs(positions.output.y - positions.input.y)) + 1e-5;\n            if (Math.abs(positions.output.x - positions.input.x) > Math.abs(positions.output.y - positions.input.y)) {\n              if (positions.output.x > positions.input.x) {\n                p1.x = maxD;\n              } else {\n                p2.x = maxD;\n              }\n            } else {\n              if (positions.output.y > positions.input.y) {\n                p1.y = maxD;\n              } else {\n                p2.y = maxD;\n              }\n            }\n            p1.x /= maxD;\n            p1.y /= maxD;\n            p2.x /= maxD;\n            p2.y /= maxD;\n\n            // Adding gradient to list\n            gradients.push(_react2.default.createElement(\n              'linearGradient',\n              {\n                key: grad_name,\n                id: grad_name,\n                x1: p1.x, y1: p1.y, x2: p2.x, y2: p2.y },\n              _react2.default.createElement('stop', { offset: '0', stopColor: connection.outputColor }),\n              _react2.default.createElement('stop', { offset: '1', stopColor: connection.inputColor })\n            ));\n          }\n        });\n      }\n\n      // Adding scroll (settings for overflow will be overwritten if defined by user)\n      var style = {\n        overflow: 'scroll',\n        backgroundColor: background_color.p\n      };\n      if (this.props.style) {\n        Object.keys(this.props.style).map(function (propkey) {\n          style[propkey] = _this2.props.style[propkey];\n        });\n      };\n\n      // Returning finished Flowspace\n      return _react2.default.createElement(\n        'div',\n        { style: style, onClick: this.handleFlowspaceClick, className: 'flowcontainer' },\n        _react2.default.createElement(\n          'div',\n          { style: { width: maxX, height: maxY, position: 'relative', overflow: 'visible' }, className: 'flowspace' },\n          _react2.default.createElement(\n            'div',\n            { ref: function ref(_ref) {\n                if (_this2.props.getDiagramRef) _this2.props.getDiagramRef(_ref);\n              }, style: { width: '100%', height: '100%', backgroundColor: background_color.p } },\n            _react2.default.createElement(\n              'svg',\n              { style: { width: '100%', height: '100%', position: 'absolute', overflow: 'visible' }, className: 'flowconnections' },\n              _react2.default.createElement(\n                'defs',\n                null,\n                Object.values(defs)\n              ),\n              gradients,\n              paths\n            ),\n            childrenWithProps\n          )\n        )\n      );\n    }\n  }]);\n\n  return Flowspace;\n}(_react.Component);\n\nexports.default = Flowspace;"]},"metadata":{},"sourceType":"script"}